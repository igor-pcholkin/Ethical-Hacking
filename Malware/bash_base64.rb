##
# to use, run
# msfvenom --payload generic/custom PAYLOADFILE=implant.sh --arch x86 --platform linux --encoder cmd/bash_base64 -o implantEncoded.sh
# NB. it may not show the encoder in msfconsole
# 
##

class MetasploitModule < Msf::Encoder
  Rank = GreatRanking

  def initialize
    super(
      'Name'             => 'Ruby Base64 Encoder',
      'Description'      => %q{
        Bash base64 ecnoder.
      },
      'Author'           => 'Random',
      'License'          => BSD_LICENSE)
  end

  def encode_block(state, buf)
    unicode = Rex::Text.to_unicode(buf)
    b64 = Rex::Text.encode_base64(unicode)
    return "#!/bin/bash\nbase64 -d <<< " + b64 + " | sh"
  end
end
